@model NguyenXuanVinh_Project2.Models.Gift
@{
    ViewData["Title"] = "Chỉnh sửa quà tặng";
}

<div class="container my-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm border-0 rounded-4">
                <div class="card-header bg-primary text-white py-3">
                    <h3 class="mb-0">
                        <i class="bi bi-pencil-square me-2"></i>Chỉnh Sửa Quà Tặng
                    </h3>
                </div>
                <div class="card-body p-4">
                    <!-- Validation Summary -->
                    <div asp-validation-summary="All" class="alert alert-danger"></div>

                    <form asp-action="Edit" method="post">
                        <input type="hidden" asp-for="GiftId" />

                        <div class="row g-3">
                            <!-- GiftId (Read-only) -->
                            <div class="col-md-6">
                                <label class="form-label fw-bold">
                                    <i class="bi bi-hash me-1"></i>Mã Quà Tặng
                                </label>
                                <input value="@Model.GiftId" class="form-control" disabled />
                                <small class="text-muted">Không thể thay đổi mã quà tặng</small>
                            </div>

                            <!-- GiftName -->
                            <div class="col-md-6">
                                <label asp-for="GiftName" class="form-label fw-bold">
                                    <i class="bi bi-tag me-1"></i>Tên Quà Tặng
                                </label>
                                <input asp-for="GiftName" class="form-control" placeholder="VD: Móc khóa Naruto" />
                                <span asp-validation-for="GiftName" class="text-danger small"></span>
                            </div>

                            <!-- Price -->
                            <div class="col-md-6">
                                <label asp-for="Price" class="form-label fw-bold">
                                    <i class="bi bi-cash-stack me-1"></i>Giá (VNĐ)
                                </label>
                                <input asp-for="Price" type="number" class="form-control" placeholder="VD: 45000" step="1000" min="0" />
                                <span asp-validation-for="Price" class="text-danger small"></span>
                            </div>

                            <!-- Stock -->
                            <div class="col-md-6">
                                <label asp-for="Stock" class="form-label fw-bold">
                                    <i class="bi bi-box-seam me-1"></i>Số Lượng Tồn Kho
                                </label>
                                <input asp-for="Stock" type="number" class="form-control" placeholder="VD: 30" min="0" />
                                <span asp-validation-for="Stock" class="text-danger small"></span>
                            </div>

                            <!-- Picture -->
                            <div class="col-12">
                                <label asp-for="Picture" class="form-label fw-bold">
                                    <i class="bi bi-image me-1"></i>Ảnh Quà Tặng
                                </label>
                                <input asp-for="Picture" class="form-control" placeholder="VD: narutokey.webp" />
                                <span asp-validation-for="Picture" class="text-danger small"></span>
                                <small class="text-muted d-block mt-1">
                                    <i class="bi bi-info-circle me-1"></i>Tên file ảnh trong thư mục wwwroot/images/gifts/
                                </small>
                            </div>

                            <!-- Description -->
                            <div class="col-12">
                                <label asp-for="Description" class="form-label fw-bold">
                                    <i class="bi bi-card-text me-1"></i>Mô Tả
                                </label>
                                <textarea asp-for="Description" class="form-control" rows="4"
                                          placeholder="Nhập mô tả chi tiết về quà tặng..."></textarea>
                                <span asp-validation-for="Description" class="text-danger small"></span>
                            </div>
                        </div>

                        <!-- Preview Section -->
                        <div class="mt-4 p-3 bg-light rounded-3">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-eye me-1"></i>Preview
                            </h6>
                            <div class="row g-3">
                                <div class="col-auto">
                                    <div class="border rounded-3 bg-white shadow-sm position-relative" style="width: 120px; height: 120px;">
                                        <img id="imagePreview"
                                             src="/images/gifts/@(Model.Picture ?? "no-gift.jpg")"
                                             class="w-100 h-100 rounded-3"
                                             style="object-fit: cover;" />
                                        <span class="badge bg-danger position-absolute top-0 end-0 m-1">
                                            <i class="bi bi-gift"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="col">
                                    <h6 class="fw-bold mb-2" id="namePreview">@Model.GiftName</h6>
                                    <p class="text-success fw-bold fs-5 mb-2">
                                        <i class="bi bi-cash-stack me-1"></i>
                                        <span id="pricePreview">@((Model.Price ?? 0).ToString("N0"))</span>đ
                                    </p>
                                    <p class="text-muted small mb-1">
                                        <i class="bi bi-box-seam me-1"></i>
                                        Còn lại: <span id="stockPreview">@Model.Stock</span> sản phẩm
                                    </p>
                                    <p class="text-muted small mb-0" id="descPreview">
                                        @{
                                            var desc = Model.Description ?? "Chưa có mô tả";
                                            var shortDesc = desc.Length > 80 ? desc.Substring(0, 80) + "..." : desc;
                                        }
                                        @shortDesc
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Buttons -->
                        <div class="d-flex gap-2 justify-content-end mt-4">
                            <a asp-action="Index" class="btn btn-secondary px-4">
                                <i class="bi bi-x-circle me-1"></i> Hủy
                            </a>
                            <button type="submit" class="btn btn-primary px-4">
                                <i class="bi bi-save me-1"></i> Cập Nhật
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Smooth transitions */
    input, select, textarea {
        transition: border-color 0.2s ease;
    }

        input:focus, select:focus, textarea:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.1);
        }

    /* Preview image hover */
    #imagePreview {
        transition: transform 0.3s ease;
    }

        #imagePreview:hover {
            transform: scale(1.05);
        }
</style>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        $(function() {
            // Live preview update
            function updatePreview() {
                const name = $('input[name="GiftName"]').val() || '@Model.GiftName';
                const price = $('input[name="Price"]').val() || '@Model.Price';
                const stock = $('input[name="Stock"]').val() || '@Model.Stock';
                const desc = $('textarea[name="Description"]').val() || '@Model.Description';
                const picture = $('input[name="Picture"]').val() || '@Model.Picture';

                $('#namePreview').text(name);
                $('#pricePreview').text(parseInt(price).toLocaleString('vi-VN'));
                $('#stockPreview').text(stock);
                $('#descPreview').text(desc.substring(0, 80) + (desc.length > 80 ? '...' : ''));

                // Update image preview
                const imgPath = '/images/gifts/' + picture;
                $('#imagePreview').attr('src', imgPath);
            }

            // Update on input change
            $('input[name="GiftName"], input[name="Price"], input[name="Stock"], textarea[name="Description"], input[name="Picture"]')
                .on('input blur', updatePreview);

            // Handle image error
            $('#imagePreview').on('error', function() {
                $(this).attr('src', '/images/gifts/no-gift.jpg');
            });

            // Highlight changes
            $('input, textarea, select').on('change', function() {
                $(this).addClass('border-warning').delay(1000).queue(function() {
                    $(this).removeClass('border-warning').dequeue();
                });
            });
        });
    </script>
}