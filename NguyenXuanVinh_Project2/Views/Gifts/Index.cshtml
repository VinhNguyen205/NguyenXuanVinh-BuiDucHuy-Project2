@model IEnumerable<NguyenXuanVinh_Project2.Models.Book>
@using System.Net

@{
    ViewData["Title"] = "Quà Tặng";
    var role = Context.Session.GetString("Role");
}

<div class="container my-5">
    <div class="text-center mb-5">
        <h1 class="fw-bold text-success">
            <i class="bi bi-gift-fill"></i> Quà Tặng Đặc Biệt
        </h1>
        <p class="text-muted">Những món quà ý nghĩa dành tặng người thân yêu</p>
    </div>

    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
        @if (Model.Any())
        {
            @foreach (var item in Model)
            {
                <div class="col">
                    <div class="card h-100 shadow-sm border-0 gift-card">
                        @{
                            var imgSrc = !string.IsNullOrEmpty(item.Picture) &&
                            (item.Picture.StartsWith("http://") || item.Picture.StartsWith("https://"))
                            ? item.Picture
                            : Url.Content("~/images/books/" + (item.Picture ?? "no-cover.jpg"));
                        }
                        <div class="position-relative">
                            <img src="@imgSrc"
                                 alt="@Html.Raw(WebUtility.HtmlDecode(item.Title ?? "Không rõ"))"
                                 class="card-img-top gift-img"
                                 onerror="this.onerror=null; this.src='/images/books/no-cover.jpg';" />
                            <span class="badge bg-danger position-absolute top-0 end-0 m-2">
                                <i class="bi bi-gift"></i> Quà tặng
                            </span>
                        </div>

                        <div class="card-body text-center">
                            <h6 class="card-title text-truncate fw-semibold"
                                title="@Html.Raw(WebUtility.HtmlDecode(item.Title ?? "Không rõ"))">
                                @Html.Raw(WebUtility.HtmlDecode(item.Title ?? "Không rõ"))
                            </h6>
                            <p class="author text-muted small mb-1">
                                <i class="bi bi-person-circle"></i>
                                @Html.Raw(WebUtility.HtmlDecode(item.Author ?? "Không rõ"))
                            </p>
                            <p class="price text-success fw-bold mb-2">
                                <i class="bi bi-cash-stack"></i>
                                @(item.Price?.ToString("N0") ?? "0") đ
                            </p>
                        </div>

                        <div class="card-footer bg-white border-0 d-flex justify-content-center gap-1">
                            <a href="@Url.Action("Details", "Books", new { id = item.BookId })"
                               class="btn btn-sm btn-outline-info" title="Chi tiết">
                                <i class="bi bi-info-circle"></i>
                            </a>

                            <button type="button" class="btn btn-sm btn-outline-success add-to-cart"
                                    data-id="@item.BookId" title="Thêm vào giỏ">
                                <i class="bi bi-cart-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="col-12 text-center py-5">
                <i class="bi bi-gift" style="font-size: 5rem; color: #ddd;"></i>
                <h4 class="text-muted mt-3">Chưa có quà tặng nào</h4>
                <p class="text-muted">Vui lòng quay lại sau!</p>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(function () {
            $(".add-to-cart").click(function () {
                var id = $(this).data("id");
                $.post('/Cart/AddToCart', { id: id })
                    .done(function (res) {
                        $("#cart-count").text(res.count);
                        alert("Đã thêm quà tặng vào giỏ!");
                    })
                    .fail(function () {
                        alert("Không thể thêm vào giỏ.");
                    });
            });
        });
    </script>
}

<style>
    .gift-card {
        border-radius: 16px;
        transition: transform 0.3s, box-shadow 0.3s;
        overflow: hidden;
    }

        .gift-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 28px rgba(220, 53, 69, 0.3);
        }

    .gift-img {
        height: 280px;
        object-fit: cover;
    }
</style>